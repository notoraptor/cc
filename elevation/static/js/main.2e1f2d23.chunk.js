(window["webpackJsonpelevation-picker"]=window["webpackJsonpelevation-picker"]||[]).push([[0],{17:function(e,t,o){e.exports=o(26)},23:function(e,t,o){},26:function(e,t,o){"use strict";o.r(t);var n=o(0),a=o.n(n),s=o(8),r=o.n(s),i=(o(22),o(23),o(3)),c=o(4),l=o(6),u=o(5),d=o(2),p=o(7);function h(){}var m=function(){function e(t,o){Object(i.a)(this,e),this.pageLoader=t||h,this.google=o||null,this.geocoder=o?new o.maps.Geocoder:null,this.autocomplete=o?new o.maps.places.AutocompleteService:null,this.locationToAddress=this.locationToAddress.bind(this),this.addressToLocation=this.addressToLocation.bind(this)}return Object(c.a)(e,[{key:"locationToAddress",value:function(e){var t=this;return new Promise((function(o,n){t.geocoder.geocode({latLng:e},(function(e,a){a===t.google.maps.GeocoderStatus.OK?o(e[0].formatted_address):n(a)}))}))}},{key:"addressToLocation",value:function(e){var t=this;return new Promise((function(o,n){t.geocoder.geocode({address:e},(function(e,a){a===t.google.maps.GeocoderStatus.OK?o(e[0].geometry.location):n(a)}))}))}}]),e}(),g=a.a.createContext(new m(null,null)),f=o(9),v=o(10),b=o(12);var y=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("div",Object.assign({},this.props.active?{className:"autocomplete-active"}:{},this.props.onClick?{onClick:this.props.onClick}:{}),this.props.value)}}]),t}(a.a.Component);var w=function(e){function t(e){var o;return Object(i.a)(this,t),(o=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={submitting:!1,windowGotFocus:!1},o.onInputFocus=o.onInputFocus.bind(Object(d.a)(o)),o.onInputBlur=o.onInputBlur.bind(Object(d.a)(o)),o.onAddressChanged=o.onAddressChanged.bind(Object(d.a)(o)),o.onKeyDown=o.onKeyDown.bind(Object(d.a)(o)),o.onSubmitAddress=o.onSubmitAddress.bind(Object(d.a)(o)),o.choosePlace=o.choosePlace.bind(Object(d.a)(o)),o.hasPlaces=o.hasPlaces.bind(Object(d.a)(o)),o.onCompletionFocus=o.onCompletionFocus.bind(Object(d.a)(o)),o.onCompletionBlur=o.onCompletionBlur.bind(Object(d.a)(o)),o.turnSubmittingFlag=o.turnSubmittingFlag.bind(Object(d.a)(o)),o.setWindowFocus=o.setWindowFocus.bind(Object(d.a)(o)),o.unsetWindowFocus=o.unsetWindowFocus.bind(Object(d.a)(o)),o}return Object(p.a)(t,e),Object(c.a)(t,[{key:"setState",value:function(e){var o=this;return new Promise((function(n){return Object(v.a)(Object(u.a)(t.prototype),"setState",o).call(o,e,n)}))}},{key:"turnSubmittingFlag",value:function(){return this.setState({submitting:!this.state.submitting})}},{key:"onInputFocus",value:function(e){this.state.windowGotFocus?this.unsetWindowFocus():this.props.onChange({autocomplete:!0})}},{key:"onInputBlur",value:function(){this.props.search.autocompleteHasFocus||this.props.onChange({autocomplete:!1})}},{key:"onCompletionFocus",value:function(){this.props.onChange({autocompleteHasFocus:!0})}},{key:"onCompletionBlur",value:function(){this.props.onChange({autocompleteHasFocus:!1})}},{key:"onAddressChanged",value:function(e){var t=this,o=e.target.value,n={address:o,error:"",currentFocus:-1,autocomplete:!0};o||(n.places=[]),this.props.onChange(n).then((function(){o&&function(e,t,o,n){var a=e;t.autocomplete.getQueryPredictions({input:a},(function(e,s){if(s===t.google.maps.places.PlacesServiceStatus.OK){var r=[];e.forEach((function(e){r.push(e.description),o&&o(r)}))}else n&&n(new Error("Unable to get autocompletion for ".concat(a,". Status ").concat(s,".")))}))}(o,t.context,(function(e){t.props.onChange({places:e})}),(function(e){console.log(e),t.props.onChange({places:[]})}))}))}},{key:"onKeyDown",value:function(e){var t=this;if(this.hasPlaces()){var o=this.props.search.places.length,n=!1,a=!1,s=this.props.search.address,r=this.props.search.currentFocus,i=this.props.search.autocomplete,c=this.props.search.autocompleteHasFocus;13===e.keyCode?(console.log("ENTER"),i&&-1!==r&&(s=this.props.search.places[r],a=n=!0),i=c=!1):27===e.keyCode?(console.log("ESCAPE"),i=c=!1):40===e.keyCode?(console.log("DOWN"),++r>=o&&(r=0),i=n=!0):38===e.keyCode&&(console.log("UP"),--r<0&&(r=o-1),i=n=!0),n&&e.preventDefault(),this.props.onChange({address:s,currentFocus:r,autocomplete:i,autocompleteHasFocus:c}).then((function(){a&&t.props.onSelect&&t.props.onSelect(s)}))}}},{key:"onSubmitAddress",value:function(e){e.preventDefault(),function(e,t){var o=document.getElementById(e);if(o)if(o.createTextRange){var n=o.createTextRange();n.move("character",t),n.select()}else void 0!==o.selectionStart?o.setSelectionRange(t,t):o.focus()}("inputAddress",0)}},{key:"choosePlace",value:function(e){var t=this.props.search.places[e];this.props.onChange({address:t,currentFocus:e,autocomplete:!1,autocompleteHasFocus:!1}),this.props.onSelect&&this.props.onSelect(t)}},{key:"hasPlaces",value:function(){return this.props.search.places.length>0&&(1!==this.props.search.places.length||this.props.search.places[0]!==this.props.search.address)}},{key:"render",value:function(){var e=this,t=this.props.search.address;return a.a.createElement("div",{className:"search"},a.a.createElement("form",{id:"search-form",onSubmit:this.onSubmitAddress,autoComplete:"off"},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md"},a.a.createElement("label",{htmlFor:"inputAddress",className:"sr-only"},"Address"),a.a.createElement(b.b,{icon:b.a}),a.a.createElement("div",{className:"autocomplete"},a.a.createElement("input",{className:"form-control",id:"inputAddress",type:"text",placeholder:"Search an address",value:t,onFocus:this.onInputFocus,onBlur:this.onInputBlur,onKeyDown:this.onKeyDown,onChange:this.onAddressChanged}),this.props.search.autocomplete&&this.hasPlaces()?a.a.createElement("div",{id:"autocomplete-list",onMouseEnter:this.onCompletionFocus,onMouseLeave:this.onCompletionBlur,className:"autocomplete-items"},this.props.search.places.map((function(t,o){return a.a.createElement(y,{active:e.props.search.currentFocus===o,onClick:function(){return e.choosePlace(o)},value:t,key:o})}))):"")))))}},{key:"setWindowFocus",value:function(){this.setState({windowGotFocus:!0})}},{key:"unsetWindowFocus",value:function(){this.setState({windowGotFocus:!1})}},{key:"componentDidMount",value:function(){window.addEventListener("focus",this.setWindowFocus)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("focus",this.setWindowFocus)}}]),t}(a.a.Component);w.contextType=g;var k=function(){function e(t){var o=this;Object(i.a)(this,e),this.isCanceled=!1,this.promise=new Promise((function(e,n){t.then((function(t){return o.isCanceled?n({isCanceled:!0}):e(t)}),(function(e){return o.isCanceled?n({isCanceled:!0}):n(e)}))})),this.cancel=this.cancel.bind(this)}return Object(c.a)(e,[{key:"cancel",value:function(){this.isCanceled=!0}}]),e}();function C(e){return{geolocationError:e}}function O(e,t){return e.lat()===t.lat()&&e.lng()===t.lng()}var S=function(e){function t(e){var o;return Object(i.a)(this,t),(o=Object(l.a)(this,Object(u.a)(t).call(this,e))).currentAddress=null,o.currentMarker=null,o.streetPositionIsManual=!1,o.map=null,o.places=null,o.elevator=null,o.defaultPosition=null,o.currentCircle=null,o.flood=[],o.zone=null,o.geolocation=null,o.userAddress=null,o.displayStreet=o.displayStreet.bind(Object(d.a)(o)),o.displayMap=o.displayMap.bind(Object(d.a)(o)),o.markMapOn=o.markMapOn.bind(Object(d.a)(o)),o.centerMap=o.centerMap.bind(Object(d.a)(o)),o.centerStreet=o.centerStreet.bind(Object(d.a)(o)),o.getUserLocation=o.getUserLocation.bind(Object(d.a)(o)),o.getElevation=o.getElevation.bind(Object(d.a)(o)),o.onMapClick=o.onMapClick.bind(Object(d.a)(o)),o.computeElevationAlongPath=o.computeElevationAlongPath.bind(Object(d.a)(o)),o}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{id:"google-map-view",className:"my-4 flex-grow-1"})}},{key:"streetIsVisible",value:function(){return this.map.getStreetView().getVisible()}},{key:"displayStreet",value:function(){console.log("Displaying street."),this.streetPositionIsManual=!0,this.map.getStreetView().setVisible(!0)}},{key:"displayMap",value:function(){this.map.getStreetView().setVisible(!1)}},{key:"searchAddress",value:function(e,t){var o=this,n=this.context.google;return new Promise((function(a,s){var r={query:e,fields:["formatted_address","geometry","name"],locationBias:new n.maps.Circle({center:t,radius:10})};o.places.findPlaceFromQuery(r,(function(e,t){t===n.maps.places.PlacesServiceStatus.OK&&e.length?a(e[0].formatted_address):s(t)}))}))}},{key:"markMapOn",value:function(e){var t=this.context.google;if(this.currentMarker&&(this.currentMarker.setMap(null),this.currentMarker=null),this.currentMarker=new t.maps.Marker({position:e,map:this.map}),this.currentCircle&&(this.currentCircle.setMap(null),this.currentCircle=null),this.props.displayUserRegions&&O(e,this.geolocation)&&(this.currentCircle=new t.maps.Circle({strokeColor:"#00FF00",strokeOpacity:.8,strokeWeight:2,fillColor:"#00FF00",fillOpacity:.35,map:this.map,center:e,radius:300}),this.currentCircle.addListener("click",this.onMapClick)),this.flood.length){var o=!0,n=!1,a=void 0;try{for(var s,r=this.flood[Symbol.iterator]();!(o=(s=r.next()).done);o=!0){s.value.setMap(null)}}catch(y){n=!0,a=y}finally{try{o||null==r.return||r.return()}finally{if(n)throw a}}this.flood=[]}this.zone&&(this.zone.setMap(null),this.zone=null);var i=function(e){return 4e7*e/360},c=function(e){return 360*e/4e7},l=function(e,t){var o=e+(Math.random()<.5?-1:1)*c(150*Math.random()+50),n=t+(Math.random()<.5?-1:1)*c(150*Math.random()+50);return{north:o,south:o+c(200),west:n,east:n+1.5*c(200)}};if(this.props.displayUserRegions&&O(e,this.geolocation)){var u=Math.round(50*Math.random()+50);console.log("Displaying ".concat(u," flood regions."));for(var d=null,p=0;p<u;++p){var h=null,m=null;d?(h=d.north,m=d.west):(h=c(i(e.lat())+300),m=c(i(e.lng())+300)),d=l(h,m),this.flood.push(new t.maps.Rectangle({strokeColor:"#33ccff",strokeOpacity:.8,strokeWeight:2,fillColor:"#33ccff",fillOpacity:.35,map:this.map,bounds:d}))}}else{var g=t.maps.geometry.spherical.computeOffset(e,500,0),f=t.maps.geometry.spherical.computeOffset(e,500,90),v=t.maps.geometry.spherical.computeOffset(e,500,180),b=t.maps.geometry.spherical.computeOffset(e,500,270);this.zone=new t.maps.Rectangle({strokeColor:"#33ccff",strokeOpacity:.8,strokeWeight:2,fillColor:"#33ccff",fillOpacity:.35,map:this.map,bounds:{north:g.lat(),south:v.lat(),east:f.lng(),west:b.lng()},editable:!1}),this.zone.addListener("click",this.onMapClick)}}},{key:"onMapClick",value:function(e){var t=this,o=e.latLng;this.centerMap(o),this.context.locationToAddress(o).then((function(e){t.currentAddress=e,t.props.onSelect(e)}))}},{key:"centerMap",value:function(e){console.log("Centering map to ".concat(e.lat()," ; ").concat(e.lng())),this.markMapOn(e),this.map.panTo(e)}},{key:"centerStreet",value:function(e){console.log("Centering street to ".concat(e.lat()," ; ").concat(e.lng())),this.streetPositionIsManual=!0,this.map.getStreetView().setPosition(e)}},{key:"_createMapOn",value:function(e){var t=this,o=this.context.google;this.map=new o.maps.Map(document.getElementById("google-map-view"),{center:e,zoom:15,streetViewControl:!1}),this.places=new o.maps.places.PlacesService(this.map),this.elevator=new o.maps.ElevationService,this.map.addListener("click",this.onMapClick),this.map.getStreetView().addListener("position_changed",(function(){if(!t.streetPositionIsManual){console.log("Handling changed position on street.");var e=t.map.getStreetView().getLocation();t.centerMap(e.latLng),t.searchAddress(e.description,e.latLng).then((function(e){t.currentAddress=e,t.props.onSelect(e)}))}}));var n=document.createElement("div");n.classList.add("google-map-street-button"),n.textContent="Street",n.index=1,n.addEventListener("click",(function(){if(t.currentMarker){var e=t.currentMarker.getPosition();t.centerStreet(e),t.displayStreet()}})),this.map.controls[o.maps.ControlPosition.TOP_LEFT].push(n),function(e,t,o){var n=document.createElement("div");n.title="Center near my current location",n.classList.add("google-map-geolocation-button"),n.index=1,n.addEventListener("click",o),r.a.render(a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},a.a.createElement("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})),n),t.controls[e.maps.ControlPosition.RIGHT_CENTER].push(n)}(o,this.map,this.getUserLocation),function(e,t,o){var n=document.createElement("div");n.title="Download elevation",n.classList.add("google-map-geolocation-button"),n.classList.add("google-map-elevation-button"),n.index=1,n.addEventListener("click",o),r.a.render(a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},a.a.createElement("path",{d:"M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z"})),n),t.controls[e.maps.ControlPosition.RIGHT_CENTER].push(n)}(o,this.map,this.getElevation),document.getElementById("google-map-view").addEventListener("click",(function(){t.streetIsVisible()&&(console.log("Clicked on street!"),t.streetPositionIsManual=!1)}))}},{key:"componentDidMount",value:function(){var e=this,t=new this.context.google.maps.LatLng(45.505331312,-73.55249779);this.defaultPosition=t,this.props.address?this.context.addressToLocation(this.props.address).catch((function(t){return console.log("Error while location for address ".concat(e.props.address,":"),t),e.defaultPosition})).then((function(t){e.currentAddress=e.props.address,e._createMapOn(t),e.centerMap(t),e.centerStreet(t),e.displayMap()})):(this._createMapOn(t),this.displayMap(),this.props.guessInitialLocation?this.getUserLocation():(this.centerMap(t),this.centerStreet(t),this.context.locationToAddress(t).then((function(t){e.currentAddress=t}))))}},{key:"componentDidUpdate",value:function(e,t,o){var n=this;this.props.address&&e.address!==this.props.address&&this.currentAddress!==this.props.address&&this.context.addressToLocation(this.props.address).catch((function(e){return console.log("Error while location for address ".concat(n.props.address,":"),e),n.defaultPosition})).then((function(e){n.currentAddress=n.props.address,n.streetIsVisible()?n.centerStreet(e):n.centerMap(e)}))}},{key:"getUserLocation",value:function(){var e=this;this.cancelablePromise||(this.cancelablePromise=new k(new Promise((function(e,t){"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(t){e(t.coords)}),(function(e){var o=null;switch(e.code){case e.PERMISSION_DENIED:o="Geolocation is not allowed in your browser.";break;case e.POSITION_UNAVAILABLE:o="Location information is unavailable.";break;case e.TIMEOUT:o="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:o="An unknown error occurred.";break;default:o="An error occurred without any error code."}t(C(o))})):t(C("Geolocation is not available in your browser."))}))),this.cancelablePromise.promise.then((function(t){if(!e.streetIsVisible()){console.log("Geolocation returned ".concat(t.latitude," ").concat(t.longitude));var o=new e.context.google.maps.LatLng(t.latitude,t.longitude);e.geolocation=o,e.centerMap(o),e.context.locationToAddress(o).then((function(t){e.currentAddress=t,e.userAddress=t,e.props.onSelect(t)}))}})).catch((function(e){"isCanceled"in e?console.error("Geolocation was canceled."):"geolocationError"in e?console.error("Geolocation error. ".concat(e.geolocationError)):(console.error("Error when getting user location."),console.exception(e))})).finally((function(){e.cancelablePromise=null})))}},{key:"computeElevationAlongPath",value:function(e,t,o){var n=this;return new Promise((function(a,s){n.elevator.getElevationAlongPath({path:[e,t],samples:o},(function(e,t){return"OK"!==t?s(t):e.length!==o?s("ERROR_SAMPLES"):void a(e)}))}))}},{key:"computeElevationForCoordinates",value:function(e){var t=this;return new Promise((function(o,n){t.elevator.getElevationForLocations({locations:e},(function(t,a){return"OK"!==a?n(a):t.length!==e.length?n("ERROR_SAMPLES"):void o(t)}))}))}},{key:"getElevation",value:function(){if(this.zone){for(var e=this.context.google,t=this.zone.getBounds(),o=t.getNorthEast(),n=t.getSouthWest(),a=new e.maps.LatLng(o.lat(),n.lng()),s=new e.maps.LatLng(n.lat(),o.lng()),r=-Math.abs(n.lat()-a.lat())/20,i=Math.abs(s.lng()-n.lng())/20,c=[a],l=1;l<441;++l){var u=c[c.length-1],d=u.lat(),p=u.lng(),h=l%21===0?d+r:d,m=l%21===0?a.lng():p+i;c.push(new e.maps.LatLng(h,m))}console.log("Computed ".concat(c.length," points.")),console.log("Latest point: ".concat(c[c.length-1]," vs expected ").concat(s)),this.computeElevationForCoordinates(c).then((function(e){var t={width:21,height:21,values:e.map((function(e){return[e.location.lat(),e.location.lng(),e.elevation]}))},o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(t))),o.setAttribute("download","elevation.json"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)})).catch((function(e){var t="An error occurred while computing elevation (".concat(e,").");console.exception(t),alert(t)}))}}},{key:"componentWillUnmount",value:function(){this.cancelablePromise&&this.cancelablePromise.cancel()}}]),t}(a.a.Component);S.contextType=g;var E=function(e){function t(e){var o;return Object(i.a)(this,t),(o=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={address:"",places:[],currentFocus:-1,autocomplete:!0,autocompleteHasFocus:!1,error:"",selectedAddress:""},o.onSearchChange=o.onSearchChange.bind(Object(d.a)(o)),o.onSelectSearchAddress=o.onSelectSearchAddress.bind(Object(d.a)(o)),o.onSelectMapAddress=o.onSelectMapAddress.bind(Object(d.a)(o)),o}return Object(p.a)(t,e),Object(c.a)(t,[{key:"setState",value:function(e){var o=this;return new Promise((function(n){return Object(v.a)(Object(u.a)(t.prototype),"setState",o).call(o,e,n)}))}},{key:"onSelectMapAddress",value:function(e){return console.log("Selected from map: ".concat(e)),this.setState({selectedAddress:e,address:e,error:""})}},{key:"onSelectSearchAddress",value:function(e){return console.log("Selected from search; ".concat(e)),this.setState({selectedAddress:e,error:""})}},{key:"onSearchChange",value:function(e){return this.setState(e)}},{key:"render",value:function(){return a.a.createElement("div",{className:"d-flex flex-column h-100"},a.a.createElement(w,{search:this.state,onChange:this.onSearchChange,onSelect:this.onSelectSearchAddress}),this.state.error?a.a.createElement("div",{className:"error-message pt-4 px-2"},this.state.error):"",a.a.createElement(S,{address:this.state.selectedAddress,onSelect:this.onSelectMapAddress,guessInitialLocation:this.props.guessInitialLocation,displayUserRegions:this.props.displayUserRegions}))}}]),t}(a.a.Component),M=o(16),j=o.n(M),A=function(e){function t(e){var o;return Object(i.a)(this,t),(o=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={context:new m(null,null)},o.loadGoogleContext=o.loadGoogleContext.bind(Object(d.a)(o)),o}return Object(p.a)(t,e),Object(c.a)(t,[{key:"loadGoogleContext",value:function(){this.setState({context:new m(this.pageLoader,window.google)})}},{key:"render",value:function(){return a.a.createElement(g.Provider,{value:this.state.context},this.state.context.google?a.a.createElement("div",{className:"container-fluid"},a.a.createElement(f.a,null,a.a.createElement("title",null,"Elevation Picker")),a.a.createElement("div",{className:"d-flex flex-column w-100 h-100"},a.a.createElement("h1",{className:"text-center"},"Elevation Picker"),a.a.createElement("div",{className:"flex-grow-1 map-container"},a.a.createElement(E,null)))):"",a.a.createElement(j.a,{async:!0,defer:!0,url:"https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyAMXLOTP3THijZgZGwmoyXvYMNf_a9jF4Y","&libraries=places,geometry"),onLoad:this.loadGoogleContext}))}}]),t}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(f.b,null,a.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[17,1,2]]]);
//# sourceMappingURL=main.2e1f2d23.chunk.js.map